{"version":3,"file":"index.cjs","sources":["../src/jsonify_notice.ts","../src/metrics.ts","../src/scope.ts","../node_modules/stackframe/stackframe.js","../node_modules/error-stack-parser/error-stack-parser.js","../src/processor/esp.ts","../src/filter/angular_message.ts","../src/filter/debounce.ts","../src/filter/ignore_noise.ts","../src/filter/uncaught_message.ts","../src/http_req/api.ts","../src/http_req/fetch.ts","../src/http_req/node.ts","../src/http_req/index.ts","../src/tdshared.ts","../src/queries.ts","../src/queues.ts","../src/routes.ts","../src/version.ts","../src/remote_settings.ts","../src/base_notifier.ts","../src/filter/window.ts","../src/instrumentation/console.ts","../src/instrumentation/dom.ts","../src/instrumentation/fetch.ts","../src/instrumentation/location.ts","../src/instrumentation/xhr.ts","../src/instrumentation/unhandledrejection.ts","../src/notifier.ts"],"sourcesContent":["import { INotice } from './notice';\n\nconst FILTERED = '[Filtered]';\nconst MAX_OBJ_LENGTH = 128;\n\n// jsonifyNotice serializes notice to JSON and truncates params,\n// environment and session keys.\nexport function jsonifyNotice(\n  notice: INotice,\n  { maxLength = 64000, keysBlocklist = [], keysAllowlist = [] } = {}\n): string {\n  if (notice.errors) {\n    for (let i = 0; i < notice.errors.length; i++) {\n      let t = new Truncator({ keysBlocklist, keysAllowlist });\n      notice.errors[i] = t.truncate(notice.errors[i]);\n    }\n  }\n\n  let s = '';\n  let keys = ['params', 'environment', 'session'];\n  for (let level = 0; level < 8; level++) {\n    let opts = { level, keysBlocklist, keysAllowlist };\n    for (let key of keys) {\n      let obj = notice[key];\n      if (obj) {\n        notice[key] = truncate(obj, opts);\n      }\n    }\n\n    s = JSON.stringify(notice);\n    if (s.length < maxLength) {\n      return s;\n    }\n  }\n\n  let params = {\n    json: s.slice(0, Math.floor(maxLength / 2)) + '...',\n  };\n  keys.push('errors');\n  for (let key of keys) {\n    let obj = notice[key];\n    if (!obj) {\n      continue;\n    }\n\n    s = JSON.stringify(obj);\n    params[key] = s.length;\n  }\n\n  let err = new Error(\n    `airbrake: notice exceeds max length and can't be truncated`\n  );\n  (err as any).params = params;\n  throw err;\n}\n\nfunction scale(num: number, level: number): number {\n  return num >> level || 1;\n}\n\ninterface ITruncatorOptions {\n  level?: number;\n  keysBlocklist?: any[];\n  keysAllowlist?: any[];\n}\n\nclass Truncator {\n  private maxStringLength = 1024;\n  private maxObjectLength = MAX_OBJ_LENGTH;\n  private maxArrayLength = MAX_OBJ_LENGTH;\n  private maxDepth = 8;\n\n  private keys: string[] = [];\n  private keysBlocklist: any[] = [];\n  private keysAllowlist: any[] = [];\n  private seen: any[] = [];\n\n  constructor(opts: ITruncatorOptions) {\n    let level = opts.level || 0;\n    this.keysBlocklist = opts.keysBlocklist || [];\n    this.keysAllowlist = opts.keysAllowlist || [];\n\n    this.maxStringLength = scale(this.maxStringLength, level);\n    this.maxObjectLength = scale(this.maxObjectLength, level);\n    this.maxArrayLength = scale(this.maxArrayLength, level);\n    this.maxDepth = scale(this.maxDepth, level);\n  }\n\n  public truncate(value: any, key = '', depth = 0): any {\n    if (value === null || value === undefined) {\n      return value;\n    }\n\n    switch (typeof value) {\n      case 'boolean':\n      case 'number':\n      case 'function':\n        return value;\n      case 'string':\n        return this.truncateString(value);\n      case 'object':\n        break;\n      default:\n        return this.truncateString(String(value));\n    }\n\n    if (value instanceof String) {\n      return this.truncateString(value.toString());\n    }\n\n    if (\n      value instanceof Boolean ||\n      value instanceof Number ||\n      value instanceof Date ||\n      value instanceof RegExp\n    ) {\n      return value;\n    }\n\n    if (value instanceof Error) {\n      return this.truncateString(value.toString());\n    }\n\n    if (this.seen.indexOf(value) >= 0) {\n      return `[Circular ${this.getPath(value)}]`;\n    }\n\n    let type = objectType(value);\n\n    depth++;\n    if (depth > this.maxDepth) {\n      return `[Truncated ${type}]`;\n    }\n\n    this.keys.push(key);\n    this.seen.push(value);\n\n    switch (type) {\n      case 'Array':\n        return this.truncateArray(value, depth);\n      case 'Object':\n        return this.truncateObject(value, depth);\n      default:\n        let saved = this.maxDepth;\n        this.maxDepth = 0;\n\n        let obj = this.truncateObject(value, depth);\n        obj.__type = type;\n\n        this.maxDepth = saved;\n\n        return obj;\n    }\n  }\n\n  private getPath(value): string {\n    let index = this.seen.indexOf(value);\n    let path = [this.keys[index]];\n    for (let i = index; i >= 0; i--) {\n      let sub = this.seen[i];\n      if (sub && getAttr(sub, path[0]) === value) {\n        value = sub;\n        path.unshift(this.keys[i]);\n      }\n    }\n    return '~' + path.join('.');\n  }\n\n  private truncateString(s: string): string {\n    if (s.length > this.maxStringLength) {\n      return s.slice(0, this.maxStringLength) + '...';\n    }\n    return s;\n  }\n\n  private truncateArray(arr: any[], depth = 0): any[] {\n    let length = 0;\n    let dst: any = [];\n    for (let i = 0; i < arr.length; i++) {\n      let el = arr[i];\n      dst.push(this.truncate(el, i.toString(), depth));\n\n      length++;\n      if (length >= this.maxArrayLength) {\n        break;\n      }\n    }\n    return dst;\n  }\n\n  private truncateObject(obj: any, depth = 0): any {\n    let length = 0;\n    let dst = {};\n    for (let key in obj) {\n      if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n        continue;\n      }\n\n      if (this.filterKey(key, dst)) continue;\n\n      let value = getAttr(obj, key);\n\n      if (value === undefined || typeof value === 'function') {\n        continue;\n      }\n      dst[key] = this.truncate(value, key, depth);\n\n      length++;\n      if (length >= this.maxObjectLength) {\n        break;\n      }\n    }\n    return dst;\n  }\n\n  private filterKey(key: string, obj: any): boolean {\n    if (\n      (this.keysAllowlist.length > 0 && !isInList(key, this.keysAllowlist)) ||\n      (this.keysAllowlist.length === 0 && isInList(key, this.keysBlocklist))\n    ) {\n      obj[key] = FILTERED;\n      return true;\n    }\n\n    return false;\n  }\n}\n\nexport function truncate(value: any, opts: ITruncatorOptions = {}): any {\n  let t = new Truncator(opts);\n  return t.truncate(value);\n}\n\nfunction getAttr(obj: any, attr: string): any {\n  // Ignore browser specific exception trying to read an attribute (#79).\n  try {\n    return obj[attr];\n  } catch (_) {\n    return;\n  }\n}\n\nfunction objectType(obj: any): string {\n  let s = Object.prototype.toString.apply(obj);\n  return s.slice('[object '.length, -1);\n}\n\nfunction isInList(key: string, list: any[]): boolean {\n  for (let v of list) {\n    if (v === key) {\n      return true;\n    }\n    if (v instanceof RegExp) {\n      if (key.match(v)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n","export interface IMetric {\n  isRecording(): boolean;\n  startSpan(name: string, startTime?: Date): void;\n  endSpan(name: string, endTime?: Date): void;\n  _incGroup(name: string, ms: number): void;\n}\n\nexport class Span {\n  _metric: IMetric | null;\n\n  name: string;\n  startTime: Date | null;\n  endTime: Date;\n\n  _dur = 0;\n  _level = 0;\n\n  constructor(metric: IMetric, name: string, startTime?: Date) {\n    this._metric = metric;\n\n    this.name = name;\n    this.startTime = startTime || new Date();\n  }\n\n  end(endTime?: Date) {\n    this.endTime = endTime ? endTime : new Date();\n\n    this._dur += this.endTime.getTime() - this.startTime!.getTime();\n    this._metric!._incGroup(this.name, this._dur);\n    this._metric = null;\n  }\n\n  _pause() {\n    if (this._paused()) {\n      return;\n    }\n    let now = new Date();\n    this._dur += now.getTime() - this.startTime!.getTime();\n    this.startTime = null;\n  }\n\n  _resume() {\n    if (!this._paused()) {\n      return;\n    }\n    this.startTime = new Date();\n  }\n\n  _paused() {\n    return this.startTime == null;\n  }\n}\n\nexport class BaseMetric implements IMetric {\n  startTime: Date;\n  endTime: Date;\n\n  _spans = {};\n  _groups = {};\n\n  constructor() {\n    this.startTime = new Date();\n  }\n\n  end(endTime?: Date): void {\n    if (!this.endTime) {\n      this.endTime = endTime || new Date();\n    }\n  }\n\n  isRecording(): boolean {\n    return true;\n  }\n\n  startSpan(name: string, startTime?: Date): void {\n    let span = this._spans[name];\n    if (span) {\n      span._level++;\n    } else {\n      span = new Span(this, name, startTime);\n      this._spans[name] = span;\n    }\n  }\n\n  endSpan(name: string, endTime?: Date): void {\n    let span = this._spans[name];\n    if (!span) {\n      console.error('airbrake: span=%s does not exist', name);\n      return;\n    }\n\n    if (span._level > 0) {\n      span._level--;\n    } else {\n      span.end(endTime);\n      delete this._spans[span.name];\n    }\n  }\n\n  _incGroup(name: string, ms: number): void {\n    this._groups[name] = (this._groups[name] || 0) + ms;\n  }\n\n  _duration(): number {\n    if (!this.endTime) {\n      this.endTime = new Date();\n    }\n    return this.endTime.getTime() - this.startTime.getTime();\n  }\n}\n\nexport class NoopMetric implements IMetric {\n  isRecording(): boolean {\n    return false;\n  }\n  startSpan(_name: string, _startTime?: Date): void {}\n  endSpan(_name: string, _startTime?: Date): void {}\n  _incGroup(_name: string, _ms: number): void {}\n}\n","import { IMetric, NoopMetric } from './metrics';\n\ninterface IHistoryRecord {\n  type: string;\n  date?: Date;\n  [key: string]: any;\n}\n\ninterface IMap {\n  [key: string]: any;\n}\n\nexport class Scope {\n  _noopMetric = new NoopMetric();\n  _routeMetric: IMetric;\n  _queueMetric: IMetric;\n\n  _context: IMap = {};\n\n  _historyMaxLen = 20;\n  _history: IHistoryRecord[] = [];\n  _lastRecord: IHistoryRecord;\n\n  clone(): Scope {\n    const clone = new Scope();\n    clone._context = { ...this._context };\n    clone._history = this._history.slice();\n    return clone;\n  }\n\n  setContext(context: IMap) {\n    this._context = { ...this._context, ...context };\n  }\n\n  context(): IMap {\n    const ctx = { ...this._context };\n    if (this._history.length > 0) {\n      ctx.history = this._history.slice();\n    }\n    return ctx;\n  }\n\n  pushHistory(state: IHistoryRecord): void {\n    if (this._isDupState(state)) {\n      if (this._lastRecord.num) {\n        this._lastRecord.num++;\n      } else {\n        this._lastRecord.num = 2;\n      }\n      return;\n    }\n\n    if (!state.date) {\n      state.date = new Date();\n    }\n    this._history.push(state);\n    this._lastRecord = state;\n\n    if (this._history.length > this._historyMaxLen) {\n      this._history = this._history.slice(-this._historyMaxLen);\n    }\n  }\n\n  private _isDupState(state): boolean {\n    if (!this._lastRecord) {\n      return false;\n    }\n    for (let key in state) {\n      if (!state.hasOwnProperty(key) || key === 'date') {\n        continue;\n      }\n      if (state[key] !== this._lastRecord[key]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  routeMetric(): IMetric {\n    return this._routeMetric || this._noopMetric;\n  }\n\n  setRouteMetric(metric: IMetric) {\n    this._routeMetric = metric;\n  }\n\n  queueMetric(): IMetric {\n    return this._queueMetric || this._noopMetric;\n  }\n\n  setQueueMetric(metric: IMetric) {\n    this._queueMetric = metric;\n  }\n}\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function() {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function _capitalize(str) {\n        return str.charAt(0).toUpperCase() + str.substring(1);\n    }\n\n    function _getter(p) {\n        return function() {\n            return this[p];\n        };\n    }\n\n    var booleanProps = ['isConstructor', 'isEval', 'isNative', 'isToplevel'];\n    var numericProps = ['columnNumber', 'lineNumber'];\n    var stringProps = ['fileName', 'functionName', 'source'];\n    var arrayProps = ['args'];\n    var objectProps = ['evalOrigin'];\n\n    var props = booleanProps.concat(numericProps, stringProps, arrayProps, objectProps);\n\n    function StackFrame(obj) {\n        if (!obj) return;\n        for (var i = 0; i < props.length; i++) {\n            if (obj[props[i]] !== undefined) {\n                this['set' + _capitalize(props[i])](obj[props[i]]);\n            }\n        }\n    }\n\n    StackFrame.prototype = {\n        getArgs: function() {\n            return this.args;\n        },\n        setArgs: function(v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        getEvalOrigin: function() {\n            return this.evalOrigin;\n        },\n        setEvalOrigin: function(v) {\n            if (v instanceof StackFrame) {\n                this.evalOrigin = v;\n            } else if (v instanceof Object) {\n                this.evalOrigin = new StackFrame(v);\n            } else {\n                throw new TypeError('Eval Origin must be an Object or StackFrame');\n            }\n        },\n\n        toString: function() {\n            var fileName = this.getFileName() || '';\n            var lineNumber = this.getLineNumber() || '';\n            var columnNumber = this.getColumnNumber() || '';\n            var functionName = this.getFunctionName() || '';\n            if (this.getIsEval()) {\n                if (fileName) {\n                    return '[eval] (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n                }\n                return '[eval]:' + lineNumber + ':' + columnNumber;\n            }\n            if (functionName) {\n                return functionName + ' (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n            }\n            return fileName + ':' + lineNumber + ':' + columnNumber;\n        }\n    };\n\n    StackFrame.fromString = function StackFrame$$fromString(str) {\n        var argsStartIndex = str.indexOf('(');\n        var argsEndIndex = str.lastIndexOf(')');\n\n        var functionName = str.substring(0, argsStartIndex);\n        var args = str.substring(argsStartIndex + 1, argsEndIndex).split(',');\n        var locationString = str.substring(argsEndIndex + 1);\n\n        if (locationString.indexOf('@') === 0) {\n            var parts = /@(.+?)(?::(\\d+))?(?::(\\d+))?$/.exec(locationString, '');\n            var fileName = parts[1];\n            var lineNumber = parts[2];\n            var columnNumber = parts[3];\n        }\n\n        return new StackFrame({\n            functionName: functionName,\n            args: args || undefined,\n            fileName: fileName,\n            lineNumber: lineNumber || undefined,\n            columnNumber: columnNumber || undefined\n        });\n    };\n\n    for (var i = 0; i < booleanProps.length; i++) {\n        StackFrame.prototype['get' + _capitalize(booleanProps[i])] = _getter(booleanProps[i]);\n        StackFrame.prototype['set' + _capitalize(booleanProps[i])] = (function(p) {\n            return function(v) {\n                this[p] = Boolean(v);\n            };\n        })(booleanProps[i]);\n    }\n\n    for (var j = 0; j < numericProps.length; j++) {\n        StackFrame.prototype['get' + _capitalize(numericProps[j])] = _getter(numericProps[j]);\n        StackFrame.prototype['set' + _capitalize(numericProps[j])] = (function(p) {\n            return function(v) {\n                if (!_isNumber(v)) {\n                    throw new TypeError(p + ' must be a Number');\n                }\n                this[p] = Number(v);\n            };\n        })(numericProps[j]);\n    }\n\n    for (var k = 0; k < stringProps.length; k++) {\n        StackFrame.prototype['get' + _capitalize(stringProps[k])] = _getter(stringProps[k]);\n        StackFrame.prototype['set' + _capitalize(stringProps[k])] = (function(p) {\n            return function(v) {\n                this[p] = String(v);\n            };\n        })(stringProps[k]);\n    }\n\n    return StackFrame;\n}));\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[()]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^()]*)|(,.*$)/g, '');\n                }\n                var sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').replace(/^.*?\\s+/, '');\n\n                // capture and preseve the parenthesized location \"(/foo/my bar.js:12:87)\" in\n                // case it has spaces in it, as the string is split on \\s+ later on\n                var location = sanitizedLine.match(/ (\\(.+\\)$)/);\n\n                // remove the parenthesized location from the line, if it was matched\n                sanitizedLine = location ? sanitizedLine.replace(location[0], '') : sanitizedLine;\n\n                // if a location was matched, pass it to extractLocation() otherwise pass all sanitizedLine\n                // because this line doesn't have function name\n                var locationParts = this.extractLocation(location ? location[1] : sanitizedLine);\n                var functionName = location && sanitizedLine || undefined;\n                var fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame({\n                    functionName: functionName,\n                    fileName: fileName,\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame({\n                        functionName: line\n                    });\n                } else {\n                    var functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\n                    var matches = line.match(functionNameRegex);\n                    var functionName = matches && matches[1] ? matches[1] : undefined;\n                    var locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\n\n                    return new StackFrame({\n                        functionName: functionName,\n                        fileName: locationParts[0],\n                        lineNumber: locationParts[1],\n                        columnNumber: locationParts[2],\n                        source: line\n                    });\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame({\n                        fileName: match[2],\n                        lineNumber: match[1],\n                        source: lines[i]\n                    }));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame({\n                            functionName: match[3] || undefined,\n                            fileName: match[2],\n                            lineNumber: match[1],\n                            source: lines[i]\n                        })\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return filtered.map(function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                    .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                    .replace(/\\([^)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^(]+\\(([^)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n\n                return new StackFrame({\n                    functionName: functionName,\n                    args: args,\n                    fileName: locationParts[0],\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        }\n    };\n}));\n","import { INoticeError, INoticeFrame } from '../notice';\n\nimport ErrorStackParser from 'error-stack-parser';\n\nconst hasConsole = typeof console === 'object' && console.warn;\n\nexport interface IStackFrame {\n  functionName?: string;\n  fileName?: string;\n  lineNumber?: number;\n  columnNumber?: number;\n}\n\nexport interface IError extends Error, IStackFrame {\n  noStack?: boolean;\n}\n\nfunction parse(err: IError): IStackFrame[] {\n  try {\n    return ErrorStackParser.parse(err);\n  } catch (parseErr) {\n    if (hasConsole && err.stack) {\n      // @ts-ignore\n      console.warn('ErrorStackParser:', parseErr.toString(), err.stack);\n    }\n  }\n\n  if (err.fileName) {\n    return [err];\n  }\n\n  return [];\n}\n\nexport function espProcessor(err: IError): INoticeError {\n  let backtrace: INoticeFrame[] = [];\n\n  if (err.noStack) {\n    backtrace.push({\n      function: err.functionName || '',\n      file: err.fileName || '',\n      line: err.lineNumber || 0,\n      column: err.columnNumber || 0,\n    });\n  } else {\n    let frames = parse(err);\n    if (frames.length === 0) {\n      try {\n        throw new Error('fake');\n      } catch (fakeErr) {\n        // @ts-ignore\n        frames = parse(fakeErr);\n        frames.shift();\n        frames.shift();\n      }\n    }\n\n    for (let frame of frames) {\n      backtrace.push({\n        function: frame.functionName || '',\n        file: frame.fileName || '',\n        line: frame.lineNumber || 0,\n        column: frame.columnNumber || 0,\n      });\n    }\n  }\n\n  let type: string = err.name ? err.name : '';\n  let msg: string = err.message ? String(err.message) : String(err);\n\n  return {\n    type,\n    message: msg,\n    backtrace,\n  };\n}\n","import { INotice } from '../notice';\n\nlet re = new RegExp(\n  [\n    '^',\n    '\\\\[(\\\\$.+)\\\\]', // type\n    '\\\\s',\n    '([\\\\s\\\\S]+)', // message\n    '$',\n  ].join('')\n);\n\nexport function angularMessageFilter(notice: INotice): INotice {\n  let err = notice.errors![0];\n  if (err.type !== '' && err.type !== 'Error') {\n    return notice;\n  }\n\n  let m = err.message.match(re);\n  if (m !== null) {\n    err.type = m[1];\n    err.message = m[2];\n  }\n\n  return notice;\n}\n","import { INotice } from '../notice';\nimport { Filter } from './filter';\n\nexport function makeDebounceFilter(): Filter {\n  let lastNoticeJSON: string;\n  let timeout;\n\n  return (notice: INotice): INotice | null => {\n    let s = JSON.stringify(notice.errors);\n    if (s === lastNoticeJSON) {\n      return null;\n    }\n\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n\n    lastNoticeJSON = s;\n    timeout = setTimeout(() => {\n      lastNoticeJSON = '';\n    }, 1000);\n\n    return notice;\n  };\n}\n","import { INotice } from '../notice';\n\nconst IGNORED_MESSAGES = [\n  'Script error',\n  'Script error.',\n  'InvalidAccessError',\n];\n\nexport function ignoreNoiseFilter(notice: INotice): INotice | null {\n  let err = notice.errors![0];\n  if (err.type === '' && IGNORED_MESSAGES.indexOf(err.message) !== -1) {\n    return null;\n  }\n\n  if (err.backtrace && err.backtrace.length > 0) {\n    let frame = err.backtrace[0];\n    if (frame.file === '<anonymous>') {\n      return null;\n    }\n  }\n\n  return notice;\n}\n","import { INotice } from '../notice';\n\nlet re = new RegExp(\n  [\n    '^',\n    'Uncaught\\\\s',\n    '(.+?)', // type\n    ':\\\\s',\n    '(.+)', // message\n    '$',\n  ].join('')\n);\nexport function uncaughtMessageFilter(notice: INotice): INotice {\n  let err = notice.errors![0];\n  if (err.type !== '' && err.type !== 'Error') {\n    return notice;\n  }\n\n  let m = err.message.match(re);\n  if (m !== null) {\n    err.type = m[1];\n    err.message = m[2];\n  }\n\n  return notice;\n}\n","export interface IHttpRequest {\n  method: string;\n  url: string;\n  body?: string;\n  timeout?: number;\n  headers?: any;\n}\n\nexport interface IHttpResponse {\n  json: any;\n}\n\nexport type Requester = (req: IHttpRequest) => Promise<IHttpResponse>;\n\nexport let errors = {\n  unauthorized: new Error(\n    'airbrake: unauthorized: project id or key are wrong'\n  ),\n  ipRateLimited: new Error('airbrake: IP is rate limited'),\n};\n","import { errors, IHttpRequest, IHttpResponse } from './api';\n\nlet rateLimitReset = 0;\n\nexport function request(req: IHttpRequest): Promise<IHttpResponse> {\n  let utime = Date.now() / 1000;\n  if (utime < rateLimitReset) {\n    return Promise.reject(errors.ipRateLimited);\n  }\n\n  let opt = {\n    method: req.method,\n    body: req.body,\n    headers: req.headers,\n  };\n  return fetch(req.url, opt).then((resp: Response) => {\n    if (resp.status === 401) {\n      throw errors.unauthorized;\n    }\n\n    if (resp.status === 429) {\n      let s = resp.headers.get('X-RateLimit-Delay');\n      if (!s) {\n        throw errors.ipRateLimited;\n      }\n\n      let n = parseInt(s, 10);\n      if (n > 0) {\n        rateLimitReset = Date.now() / 1000 + n;\n      }\n\n      throw errors.ipRateLimited;\n    }\n\n    if (resp.status === 204) {\n      return { json: null };\n    }\n    if (resp.status === 404) {\n      throw new Error('404 Not Found');\n    }\n\n    if (resp.status >= 200 && resp.status < 300) {\n      return resp.json().then((json) => {\n        return { json };\n      });\n    }\n\n    if (resp.status >= 400 && resp.status < 500) {\n      return resp.json().then((json) => {\n        let err = new Error(json.message);\n        throw err;\n      });\n    }\n\n    return resp.text().then((body) => {\n      let err = new Error(\n        `airbrake: fetch: unexpected response: code=${resp.status} body='${body}'`\n      );\n      throw err;\n    });\n  });\n}\n","import * as request_lib from 'request';\n\nimport { errors, IHttpRequest, IHttpResponse, Requester } from './api';\n\ntype requestAPI = request_lib.RequestAPI<\n  request_lib.Request,\n  request_lib.CoreOptions,\n  request_lib.RequiredUriUrl\n>;\n\nexport function makeRequester(api: requestAPI): Requester {\n  return (req: IHttpRequest): Promise<IHttpResponse> => {\n    return request(req, api);\n  };\n}\n\nlet rateLimitReset = 0;\n\nfunction request(req: IHttpRequest, api: requestAPI): Promise<IHttpResponse> {\n  let utime = Date.now() / 1000;\n  if (utime < rateLimitReset) {\n    return Promise.reject(errors.ipRateLimited);\n  }\n\n  return new Promise((resolve, reject) => {\n    api(\n      {\n        url: req.url,\n        method: req.method,\n        body: req.body,\n        headers: {\n          'content-type': 'application/json',\n        },\n        timeout: req.timeout,\n      },\n      (error: any, resp: request_lib.RequestResponse, body: any): void => {\n        if (error) {\n          reject(error);\n          return;\n        }\n\n        if (!resp.statusCode) {\n          error = new Error(\n            `airbrake: request: response statusCode is ${resp.statusCode}`\n          );\n          reject(error);\n          return;\n        }\n\n        if (resp.statusCode === 401) {\n          reject(errors.unauthorized);\n          return;\n        }\n\n        if (resp.statusCode === 429) {\n          reject(errors.ipRateLimited);\n\n          let h = resp.headers['x-ratelimit-delay'];\n          if (!h) {\n            return;\n          }\n\n          let s: string;\n          if (typeof h === 'string') {\n            s = h;\n          } else if (h instanceof Array) {\n            s = h[0];\n          } else {\n            return;\n          }\n\n          let n = parseInt(s, 10);\n          if (n > 0) {\n            rateLimitReset = Date.now() / 1000 + n;\n          }\n\n          return;\n        }\n\n        if (resp.statusCode === 204) {\n          resolve({ json: null });\n          return;\n        }\n\n        if (resp.statusCode >= 200 && resp.statusCode < 300) {\n          let json;\n          try {\n            json = JSON.parse(body);\n          } catch (err) {\n            reject(err);\n            return;\n          }\n          resolve(json);\n          return;\n        }\n\n        if (resp.statusCode >= 400 && resp.statusCode < 500) {\n          let json;\n          try {\n            json = JSON.parse(body);\n          } catch (err) {\n            reject(err);\n            return;\n          }\n          error = new Error(json.message);\n          reject(error);\n          return;\n        }\n\n        body = body.trim();\n        error = new Error(\n          `airbrake: node: unexpected response: code=${resp.statusCode} body='${body}'`\n        );\n        reject(error);\n      }\n    );\n  });\n}\n","import { IOptions } from '../options';\nimport { Requester } from './api';\nimport { request as fetchRequest } from './fetch';\nimport { makeRequester as makeNodeRequester } from './node';\n\nexport type { Requester };\n\nexport function makeRequester(opts: IOptions): Requester {\n  if (opts.request) {\n    return makeNodeRequester(opts.request);\n  }\n  return fetchRequest;\n}\n","let tdigest;\nexport let hasTdigest = false;\n\ntry {\n  tdigest = require('tdigest');\n  hasTdigest = true;\n} catch (err) {}\n\ninterface ICentroid {\n  mean: number;\n  n: number;\n}\n\ninterface ICentroids {\n  each(fn: (c: ICentroid) => void): void;\n}\n\ninterface ITDigest {\n  centroids: ICentroids;\n\n  push(x: number);\n  compress();\n}\n\ninterface ITDigestCentroids {\n  mean: number[];\n  count: number[];\n}\n\nexport class TDigestStat {\n  count = 0;\n  sum = 0;\n  sumsq = 0;\n  _td = new tdigest.Digest();\n\n  add(ms: number) {\n    if (ms === 0) {\n      ms = 0.00001;\n    }\n    this.count += 1;\n    this.sum += ms;\n    this.sumsq += ms * ms;\n    if (this._td) {\n      this._td.push(ms);\n    }\n  }\n\n  toJSON() {\n    return {\n      count: this.count,\n      sum: this.sum,\n      sumsq: this.sumsq,\n      tdigestCentroids: tdigestCentroids(this._td),\n    };\n  }\n}\n\nexport class TDigestStatGroups extends TDigestStat {\n  groups: { [key: string]: TDigestStat } = {};\n\n  addGroups(totalMs: number, groups: { [key: string]: number }) {\n    this.add(totalMs);\n    for (const name in groups) {\n      if (groups.hasOwnProperty(name)) {\n        this.addGroup(name, groups[name]);\n      }\n    }\n  }\n\n  addGroup(name: string, ms: number) {\n    let stat = this.groups[name];\n    if (!stat) {\n      stat = new TDigestStat();\n      this.groups[name] = stat;\n    }\n    stat.add(ms);\n  }\n\n  toJSON() {\n    return {\n      count: this.count,\n      sum: this.sum,\n      sumsq: this.sumsq,\n      tdigestCentroids: tdigestCentroids(this._td),\n      groups: this.groups,\n    };\n  }\n}\n\nfunction tdigestCentroids(td: ITDigest): ITDigestCentroids {\n  let means: number[] = [];\n  let counts: number[] = [];\n  td.centroids.each((c: ICentroid) => {\n    means.push(c.mean);\n    counts.push(c.n);\n  });\n  return {\n    mean: means,\n    count: counts,\n  };\n}\n","import { makeRequester, Requester } from './http_req';\nimport { IOptions } from './options';\nimport { hasTdigest, TDigestStat } from './tdshared';\n\nconst FLUSH_INTERVAL = 15000; // 15 seconds\n\ninterface IQueryKey {\n  method: string;\n  route: string;\n  query: string;\n  func: string;\n  file: string;\n  line: number;\n  time: Date;\n}\n\nexport class QueryInfo {\n  method = '';\n  route = '';\n  query = '';\n  func = '';\n  file = '';\n  line = 0;\n  startTime = new Date();\n  endTime: Date;\n\n  constructor(query = '') {\n    this.query = query;\n  }\n\n  _duration(): number {\n    if (!this.endTime) {\n      this.endTime = new Date();\n    }\n    return this.endTime.getTime() - this.startTime.getTime();\n  }\n}\n\nexport class QueriesStats {\n  _opt: IOptions;\n  _url: string;\n  _requester: Requester;\n\n  _m: { [key: string]: TDigestStat } = {};\n  _timer;\n\n  constructor(opt: IOptions) {\n    this._opt = opt;\n    this._url = `${opt.host}/api/v5/projects/${opt.projectId}/queries-stats?key=${opt.projectKey}`;\n    this._requester = makeRequester(opt);\n  }\n\n  start(query = ''): QueryInfo {\n    return new QueryInfo(query);\n  }\n\n  notify(q: QueryInfo): void {\n    if (!hasTdigest) {\n      return;\n    }\n\n    if (!this._opt.performanceStats) {\n      return;\n    }\n    if (!this._opt.queryStats) {\n      return;\n    }\n\n    let ms = q._duration();\n\n    const minute = 60 * 1000;\n    let startTime = new Date(\n      Math.floor(q.startTime.getTime() / minute) * minute\n    );\n\n    let key: IQueryKey = {\n      method: q.method,\n      route: q.route,\n      query: q.query,\n      func: q.func,\n      file: q.file,\n      line: q.line,\n      time: startTime,\n    };\n    let keyStr = JSON.stringify(key);\n\n    let stat = this._m[keyStr];\n    if (!stat) {\n      stat = new TDigestStat();\n      this._m[keyStr] = stat;\n    }\n\n    stat.add(ms);\n\n    if (this._timer) {\n      return;\n    }\n    this._timer = setTimeout(() => {\n      this._flush();\n    }, FLUSH_INTERVAL);\n  }\n\n  _flush(): void {\n    let queries = [];\n    for (let keyStr in this._m) {\n      if (!this._m.hasOwnProperty(keyStr)) {\n        continue;\n      }\n\n      let key: IQueryKey = JSON.parse(keyStr);\n      let v = {\n        ...key,\n        ...this._m[keyStr].toJSON(),\n      };\n\n      // @ts-ignore\n      queries.push(v);\n    }\n\n    this._m = {};\n    this._timer = null;\n\n    let outJSON = JSON.stringify({\n      environment: this._opt.environment,\n      queries,\n    });\n    let req = {\n      method: 'POST',\n      url: this._url,\n      body: outJSON,\n    };\n    this._requester(req)\n      .then((_resp) => {\n        // nothing\n      })\n      .catch((err) => {\n        if (console.error) {\n          console.error('can not report queries stats', err);\n        }\n      });\n  }\n}\n","import { makeRequester, Requester } from './http_req';\nimport { BaseMetric } from './metrics';\nimport { IOptions } from './options';\nimport { hasTdigest, TDigestStatGroups } from './tdshared';\n\nconst FLUSH_INTERVAL = 15000; // 15 seconds\n\ninterface IQueueKey {\n  queue: string;\n  time: Date;\n}\n\nexport class QueueMetric extends BaseMetric {\n  queue: string;\n\n  constructor(queue: string) {\n    super();\n    this.queue = queue;\n    this.startTime = new Date();\n  }\n}\n\nexport class QueuesStats {\n  _opt: IOptions;\n  _url: string;\n  _requester: Requester;\n\n  _m: { [key: string]: TDigestStatGroups } = {};\n  _timer;\n\n  constructor(opt: IOptions) {\n    this._opt = opt;\n    this._url = `${opt.host}/api/v5/projects/${opt.projectId}/queues-stats?key=${opt.projectKey}`;\n    this._requester = makeRequester(opt);\n  }\n\n  notify(q: QueueMetric): void {\n    if (!hasTdigest) {\n      return;\n    }\n\n    if (!this._opt.performanceStats) {\n      return;\n    }\n    if (!this._opt.queueStats) {\n      return;\n    }\n\n    let ms = q._duration();\n    if (ms === 0) {\n      ms = 0.00001;\n    }\n\n    const minute = 60 * 1000;\n    let startTime = new Date(\n      Math.floor(q.startTime.getTime() / minute) * minute\n    );\n\n    let key: IQueueKey = {\n      queue: q.queue,\n      time: startTime,\n    };\n    let keyStr = JSON.stringify(key);\n\n    let stat = this._m[keyStr];\n    if (!stat) {\n      stat = new TDigestStatGroups();\n      this._m[keyStr] = stat;\n    }\n\n    stat.addGroups(ms, q._groups);\n\n    if (this._timer) {\n      return;\n    }\n    this._timer = setTimeout(() => {\n      this._flush();\n    }, FLUSH_INTERVAL);\n  }\n\n  _flush(): void {\n    let queues = [];\n    for (let keyStr in this._m) {\n      if (!this._m.hasOwnProperty(keyStr)) {\n        continue;\n      }\n\n      let key: IQueueKey = JSON.parse(keyStr);\n      let v = {\n        ...key,\n        ...this._m[keyStr].toJSON(),\n      };\n\n      // @ts-ignore\n      queues.push(v);\n    }\n\n    this._m = {};\n    this._timer = null;\n\n    let outJSON = JSON.stringify({\n      environment: this._opt.environment,\n      queues,\n    });\n    let req = {\n      method: 'POST',\n      url: this._url,\n      body: outJSON,\n    };\n    this._requester(req)\n      .then((_resp) => {\n        // nothing\n      })\n      .catch((err) => {\n        if (console.error) {\n          console.error('can not report queues breakdowns', err);\n        }\n      });\n  }\n}\n","import { makeRequester, Requester } from './http_req';\nimport { BaseMetric } from './metrics';\nimport { IOptions } from './options';\nimport { hasTdigest, TDigestStat, TDigestStatGroups } from './tdshared';\n\nconst FLUSH_INTERVAL = 15000; // 15 seconds\n\ninterface IRouteKey {\n  method: string;\n  route: string;\n  statusCode: number;\n  time: Date;\n}\n\ninterface IBreakdownKey {\n  method: string;\n  route: string;\n  responseType: string;\n  time: Date;\n}\n\nexport class RouteMetric extends BaseMetric {\n  method: string;\n  route: string;\n  statusCode: number;\n  contentType: string;\n\n  constructor(method = '', route = '', statusCode = 0, contentType = '') {\n    super();\n    this.method = method;\n    this.route = route;\n    this.statusCode = statusCode;\n    this.contentType = contentType;\n    this.startTime = new Date();\n  }\n}\n\nexport class RoutesStats {\n  _opt: IOptions;\n  _url: string;\n  _requester: Requester;\n\n  _m: { [key: string]: TDigestStat } = {};\n  _timer;\n\n  constructor(opt: IOptions) {\n    this._opt = opt;\n    this._url = `${opt.host}/api/v5/projects/${opt.projectId}/routes-stats?key=${opt.projectKey}`;\n    this._requester = makeRequester(opt);\n  }\n\n  notify(req: RouteMetric): void {\n    if (!hasTdigest) {\n      return;\n    }\n\n    if (!this._opt.performanceStats) {\n      return;\n    }\n\n    let ms = req._duration();\n\n    const minute = 60 * 1000;\n    let startTime = new Date(\n      Math.floor(req.startTime.getTime() / minute) * minute\n    );\n\n    let key: IRouteKey = {\n      method: req.method,\n      route: req.route,\n      statusCode: req.statusCode,\n      time: startTime,\n    };\n    let keyStr = JSON.stringify(key);\n\n    let stat = this._m[keyStr];\n    if (!stat) {\n      stat = new TDigestStat();\n      this._m[keyStr] = stat;\n    }\n\n    stat.add(ms);\n\n    if (this._timer) {\n      return;\n    }\n    this._timer = setTimeout(() => {\n      this._flush();\n    }, FLUSH_INTERVAL);\n  }\n\n  _flush(): void {\n    let routes = [];\n    for (let keyStr in this._m) {\n      if (!this._m.hasOwnProperty(keyStr)) {\n        continue;\n      }\n\n      let key: IRouteKey = JSON.parse(keyStr);\n      let v = {\n        ...key,\n        ...this._m[keyStr].toJSON(),\n      };\n\n      // @ts-ignore\n      routes.push(v);\n    }\n\n    this._m = {};\n    this._timer = null;\n\n    let outJSON = JSON.stringify({\n      environment: this._opt.environment,\n      routes,\n    });\n    let req = {\n      method: 'POST',\n      url: this._url,\n      body: outJSON,\n    };\n    this._requester(req)\n      .then((_resp) => {\n        // nothing\n      })\n      .catch((err) => {\n        if (console.error) {\n          console.error('can not report routes stats', err);\n        }\n      });\n  }\n}\n\nexport class RoutesBreakdowns {\n  _opt: IOptions;\n  _url: string;\n  _requester: Requester;\n\n  _m: { [key: string]: TDigestStatGroups } = {};\n  _timer;\n\n  constructor(opt: IOptions) {\n    this._opt = opt;\n    this._url = `${opt.host}/api/v5/projects/${opt.projectId}/routes-breakdowns?key=${opt.projectKey}`;\n    this._requester = makeRequester(opt);\n  }\n\n  notify(req: RouteMetric): void {\n    if (!hasTdigest) {\n      return;\n    }\n\n    if (!this._opt.performanceStats) {\n      return;\n    }\n\n    if (\n      req.statusCode < 200 ||\n      (req.statusCode >= 300 && req.statusCode < 400) ||\n      req.statusCode === 404 ||\n      Object.keys(req._groups).length === 0\n    ) {\n      return;\n    }\n\n    let ms = req._duration();\n    if (ms === 0) {\n      ms = 0.00001;\n    }\n\n    const minute = 60 * 1000;\n    let startTime = new Date(\n      Math.floor(req.startTime.getTime() / minute) * minute\n    );\n\n    let key: IBreakdownKey = {\n      method: req.method,\n      route: req.route,\n      responseType: this._responseType(req),\n      time: startTime,\n    };\n    let keyStr = JSON.stringify(key);\n\n    let stat = this._m[keyStr];\n    if (!stat) {\n      stat = new TDigestStatGroups();\n      this._m[keyStr] = stat;\n    }\n\n    stat.addGroups(ms, req._groups);\n\n    if (this._timer) {\n      return;\n    }\n    this._timer = setTimeout(() => {\n      this._flush();\n    }, FLUSH_INTERVAL);\n  }\n\n  _flush(): void {\n    let routes = [];\n    for (let keyStr in this._m) {\n      if (!this._m.hasOwnProperty(keyStr)) {\n        continue;\n      }\n\n      let key: IBreakdownKey = JSON.parse(keyStr);\n      let v = {\n        ...key,\n        ...this._m[keyStr].toJSON(),\n      };\n\n      // @ts-ignore\n      routes.push(v);\n    }\n\n    this._m = {};\n    this._timer = null;\n\n    let outJSON = JSON.stringify({\n      environment: this._opt.environment,\n      routes,\n    });\n    let req = {\n      method: 'POST',\n      url: this._url,\n      body: outJSON,\n    };\n    this._requester(req)\n      .then((_resp) => {\n        // nothing\n      })\n      .catch((err) => {\n        if (console.error) {\n          console.error('can not report routes breakdowns', err);\n        }\n      });\n  }\n\n  _responseType(req: RouteMetric): string {\n    if (req.statusCode >= 500) {\n      return '5xx';\n    }\n    if (req.statusCode >= 400) {\n      return '4xx';\n    }\n    if (!req.contentType) {\n      return '';\n    }\n    const s = req.contentType.split(';')[0].split('/');\n    return s[s.length - 1];\n  }\n}\n","export const NOTIFIER_NAME = 'airbrake-js/browser';\nexport const NOTIFIER_VERSION = '2.1.8';\nexport const NOTIFIER_URL =\n  'https://github.com/airbrake/airbrake-js/tree/master/packages/browser';\n","import { makeRequester, Requester } from './http_req';\nimport { IOptions } from './options';\nimport { NOTIFIER_NAME, NOTIFIER_VERSION } from './version';\n\n// API version to poll.\nconst API_VER = '2020-06-18';\n\n// How frequently we should poll the config API.\nconst DEFAULT_INTERVAL = 600000; // 10 minutes\n\nconst NOTIFIER_INFO = {\n  notifier_name: NOTIFIER_NAME,\n  notifier_version: NOTIFIER_VERSION,\n  os:\n    typeof window !== 'undefined' &&\n    window.navigator &&\n    window.navigator.userAgent\n      ? window.navigator.userAgent\n      : undefined,\n  language: 'JavaScript',\n};\n\n// Remote config settings.\nconst ERROR_SETTING = 'errors';\nconst APM_SETTING = 'apm';\n\ninterface IRemoteConfig {\n  project_id: number | null;\n  updated_at: number;\n  poll_sec: number;\n  config_route: string;\n  settings: IRemoteConfigSetting[];\n}\n\ninterface IRemoteConfigSetting {\n  name: string;\n  enabled: boolean;\n  endpoint: string;\n}\n\ntype Entries<T> = {\n  [K in keyof T]: [K, T[K]];\n}[keyof T][];\n\nexport class RemoteSettings {\n  _opt: IOptions;\n  _requester: Requester;\n  _data: SettingsData;\n  _origErrorNotifications: boolean | undefined;\n  _origPerformanceStats: boolean | undefined;\n\n  constructor(opt: IOptions) {\n    this._opt = opt;\n    this._requester = makeRequester(opt);\n\n    this._data = new SettingsData(opt.projectId, {\n      project_id: null,\n      poll_sec: 0,\n      updated_at: 0,\n      config_route: '',\n      settings: [],\n    });\n\n    this._origErrorNotifications = opt.errorNotifications;\n    this._origPerformanceStats = opt.performanceStats;\n  }\n\n  poll(): any {\n    // First request is immediate. When it's done, we cancel it since we want to\n    // change interval time to the default value.\n    const pollerId = setInterval(() => {\n      this._doRequest();\n      clearInterval(pollerId);\n    }, 0);\n\n    // Second fetch is what always runs in background.\n    return setInterval(this._doRequest.bind(this), DEFAULT_INTERVAL);\n  }\n\n  _doRequest(): void {\n    this._requester(this._requestParams(this._opt))\n      .then((resp) => {\n        this._data.merge(resp.json);\n\n        this._opt.host = this._data.errorHost();\n        this._opt.apmHost = this._data.apmHost();\n\n        this._processErrorNotifications(this._data);\n        this._processPerformanceStats(this._data);\n      })\n      .catch((_) => {\n        return;\n      });\n  }\n\n  _requestParams(opt: IOptions): any {\n    return {\n      method: 'GET',\n      url: this._pollUrl(opt),\n      headers: {\n        Accept: 'application/json',\n        'Cache-Control': 'no-cache,no-store',\n      },\n    };\n  }\n\n  _pollUrl(opt: IOptions): string {\n    const url = this._data.configRoute(opt.remoteConfigHost!);\n    let queryParams = '?';\n\n    for (const [key, value] of this._entries(NOTIFIER_INFO)) {\n      queryParams += `&${encodeURIComponent(key)}=${encodeURIComponent(value!)}`;\n    }\n\n    return url + queryParams;\n  }\n\n  _processErrorNotifications(data: SettingsData): void {\n    if (!this._origErrorNotifications) {\n      return;\n    }\n    this._opt.errorNotifications = data.errorNotifications();\n  }\n\n  _processPerformanceStats(data: SettingsData): void {\n    if (!this._origPerformanceStats) {\n      return;\n    }\n    this._opt.performanceStats = data.performanceStats();\n  }\n\n  // Polyfill from:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries#polyfill\n  _entries<T>(obj: T): Entries<T> {\n    // @ts-ignore\n    const ownProps = Object.keys(obj);\n    let i = ownProps.length;\n    const resArray = new Array(i);\n\n    while (i--) resArray[i] = [ownProps[i], obj[ownProps[i]]];\n\n    return resArray;\n  }\n}\n\nexport class SettingsData {\n  _projectId: number;\n  _data: IRemoteConfig;\n\n  constructor(projectId: number, data: IRemoteConfig) {\n    this._projectId = projectId;\n    this._data = data;\n  }\n\n  merge(other: IRemoteConfig) {\n    this._data = { ...this._data, ...other };\n  }\n\n  configRoute(remoteConfigHost: string): string {\n    const host = remoteConfigHost.replace(/\\/$/, '');\n    const configRoute = this._data.config_route;\n\n    if (\n      configRoute === null ||\n      configRoute === undefined ||\n      configRoute === ''\n    ) {\n      return `${host}/${API_VER}/config/${this._projectId}/config.json`;\n    } else {\n      return `${host}/${configRoute}`;\n    }\n  }\n\n  errorNotifications(): boolean {\n    const s = this._findSetting(ERROR_SETTING);\n    if (s === null) {\n      return true;\n    }\n\n    return s.enabled;\n  }\n\n  performanceStats(): boolean {\n    const s = this._findSetting(APM_SETTING);\n    if (s === null) {\n      return true;\n    }\n\n    return s.enabled;\n  }\n\n  errorHost(): string | null {\n    const s = this._findSetting(ERROR_SETTING);\n    if (s === null) {\n      return null;\n    }\n\n    return s.endpoint;\n  }\n\n  apmHost(): string | null{\n    const s = this._findSetting(APM_SETTING);\n    if (s === null) {\n      return null;\n    }\n\n    return s.endpoint;\n  }\n\n  _findSetting(name: string): IRemoteConfigSetting | null {\n    const settings = this._data.settings;\n    if (settings === null || settings === undefined) {\n      return null;\n    }\n\n    const setting = settings.find((s) => {\n      return s.name === name;\n    });\n\n    if (setting === undefined) {\n      return null;\n    }\n\n    return setting;\n  }\n}\n","import { IFuncWrapper } from './func_wrapper';\nimport { jsonifyNotice } from './jsonify_notice';\nimport { INotice } from './notice';\nimport { Scope } from './scope';\n\nimport { espProcessor } from './processor/esp';\nimport { Processor } from './processor/processor';\n\nimport { angularMessageFilter } from './filter/angular_message';\nimport { makeDebounceFilter } from './filter/debounce';\nimport { Filter } from './filter/filter';\nimport { ignoreNoiseFilter } from './filter/ignore_noise';\nimport { uncaughtMessageFilter } from './filter/uncaught_message';\n\nimport { makeRequester, Requester } from './http_req';\n\nimport { IOptions } from './options';\nimport { QueriesStats } from './queries';\nimport { QueueMetric, QueuesStats } from './queues';\nimport { RouteMetric, RoutesBreakdowns, RoutesStats } from './routes';\nimport { NOTIFIER_NAME, NOTIFIER_VERSION, NOTIFIER_URL } from './version';\nimport { PerformanceFilter } from './filter/performance_filter';\nimport { RemoteSettings } from './remote_settings';\n\nexport class BaseNotifier {\n  routes: Routes;\n  queues: Queues;\n  queries: QueriesStats;\n\n  _opt: IOptions;\n  _url: string;\n\n  _processor: Processor;\n  _requester: Requester;\n  _filters: Filter[] = [];\n  _performanceFilters: PerformanceFilter[] = [];\n  _scope = new Scope();\n\n  _onClose: (() => void)[] = [];\n\n  constructor(opt: IOptions) {\n    if (!opt.projectId || !opt.projectKey) {\n      throw new Error('airbrake: projectId and projectKey are required');\n    }\n\n    this._opt = opt;\n    this._opt.host = this._opt.host || 'https://api.airbrake.io';\n    this._opt.remoteConfigHost =\n      this._opt.remoteConfigHost || 'https://notifier-configs.airbrake.io';\n    this._opt.apmHost = this._opt.apmHost || 'https://api.airbrake.io';\n    this._opt.timeout = this._opt.timeout || 10000;\n    this._opt.keysBlocklist = this._opt.keysBlocklist || [/password/, /secret/];\n    this._url = `${this._opt.host}/api/v3/projects/${this._opt.projectId}/notices?key=${this._opt.projectKey}`;\n\n    this._opt.errorNotifications = this._opt.errorNotifications !== false;\n    this._opt.performanceStats = this._opt.performanceStats !== false;\n\n    this._opt.queryStats = this._opt.queryStats !== false;\n    this._opt.queueStats = this._opt.queueStats !== false;\n\n    this._opt.remoteConfig = this._opt.remoteConfig !== false;\n\n    this._processor = this._opt.processor || espProcessor;\n    this._requester = makeRequester(this._opt);\n\n    this.addFilter(ignoreNoiseFilter);\n    this.addFilter(makeDebounceFilter());\n    this.addFilter(uncaughtMessageFilter);\n    this.addFilter(angularMessageFilter);\n\n    this.addFilter((notice: INotice): INotice | null => {\n      notice.context.notifier = {\n        name: NOTIFIER_NAME,\n        version: NOTIFIER_VERSION,\n        url: NOTIFIER_URL,\n      };\n      if (this._opt.environment) {\n        notice.context.environment = this._opt.environment;\n      }\n      return notice;\n    });\n\n    this.routes = new Routes(this);\n    this.queues = new Queues(this);\n    this.queries = new QueriesStats(this._opt);\n\n    if (this._opt.remoteConfig) {\n      const pollerId = new RemoteSettings(this._opt).poll();\n      this._onClose.push(() => clearInterval(pollerId));\n    }\n  }\n\n  close(): void {\n    for (let fn of this._onClose) {\n      fn();\n    }\n  }\n\n  scope(): Scope {\n    return this._scope;\n  }\n\n  setActiveScope(scope: Scope) {\n    this._scope = scope;\n  }\n\n  addFilter(filter: Filter): void {\n    this._filters.push(filter);\n  }\n\n  addPerformanceFilter(performanceFilter: PerformanceFilter) {\n    this._performanceFilters.push(performanceFilter);\n  }\n\n  notify(err: any): Promise<INotice> {\n    if (typeof err !== 'object' || err === null || !('error' in err)) {\n      err = { error: err };\n    }\n    this.handleFalseyError(err);\n\n    let notice = this.newNotice(err);\n\n    if (!this._opt.errorNotifications) {\n      notice.error = new Error(\n        `airbrake: not sending this error, errorNotifications is disabled err=${JSON.stringify(\n          err.error\n        )}`\n      );\n      return Promise.resolve(notice);\n    }\n\n    let error = this._processor(err.error);\n    notice.errors!.push(error);\n\n    for (let filter of this._filters) {\n      let r = filter(notice);\n      if (r === null) {\n        notice.error = new Error('airbrake: error is filtered');\n        return Promise.resolve(notice);\n      }\n      notice = r;\n    }\n\n    if (!notice.context) {\n      notice.context = {};\n    }\n    notice.context.language = 'JavaScript';\n    return this._sendNotice(notice);\n  }\n\n  private handleFalseyError(err: any) {\n    if (Number.isNaN(err.error)) {\n      err.error = new Error('NaN');\n    } else if (err.error === undefined) {\n      err.error = new Error('undefined');\n    } else if (err.error === '') {\n      err.error = new Error('<empty string>');\n    } else if (err.error === null) {\n      err.error = new Error('null');\n    }\n  }\n\n  private newNotice(err: any): INotice {\n    return {\n      errors: [],\n      context: {\n        severity: 'error',\n        ...this.scope().context(),\n        ...err.context,\n      },\n      params: err.params || {},\n      environment: err.environment || {},\n      session: err.session || {},\n    };\n  }\n\n  _sendNotice(notice: INotice): Promise<INotice> {\n    // @ts-ignore\n    let body = jsonifyNotice(notice, {\n      // @ts-ignore\n      keysBlocklist: this._opt.keysBlocklist,\n    });\n    if (this._opt.reporter) {\n      if (typeof this._opt.reporter === 'function') {\n        return this._opt.reporter(notice);\n      } else {\n        console.warn('airbrake: options.reporter must be a function');\n      }\n    }\n\n    let req = {\n      method: 'POST',\n      url: this._url,\n      body,\n    };\n    return this._requester(req)\n      .then((resp) => {\n        notice.id = resp.json.id;\n        notice.url = resp.json.url;\n        return notice;\n      })\n      .catch((err) => {\n        notice.error = err;\n        return notice;\n      });\n  }\n\n  wrap(fn, props: string[] = []): IFuncWrapper {\n    if (fn._airbrake) {\n      return fn;\n    }\n\n    // tslint:disable-next-line:no-this-assignment\n    let client = this;\n    let airbrakeWrapper = function () {\n      let fnArgs = Array.prototype.slice.call(arguments);\n      let wrappedArgs = client._wrapArguments(fnArgs);\n      try {\n        // @ts-ignore\n        return fn.apply(this, wrappedArgs);\n      } catch (err) {\n        client.notify({ error: err, params: { arguments: fnArgs } });\n        client._ignoreNextWindowError();\n        throw err;\n      }\n    } as IFuncWrapper;\n\n    for (let prop in fn) {\n      if (fn.hasOwnProperty(prop)) {\n        airbrakeWrapper[prop] = fn[prop];\n      }\n    }\n    for (let prop of props) {\n      if (fn.hasOwnProperty(prop)) {\n        airbrakeWrapper[prop] = fn[prop];\n      }\n    }\n\n    airbrakeWrapper._airbrake = true;\n    airbrakeWrapper.inner = fn;\n\n    return airbrakeWrapper;\n  }\n\n  _wrapArguments(args: any[]): any[] {\n    for (let i = 0; i < args.length; i++) {\n      let arg = args[i];\n      if (typeof arg === 'function') {\n        args[i] = this.wrap(arg);\n      }\n    }\n    return args;\n  }\n\n  _ignoreNextWindowError() {}\n\n  call(fn, ..._args: any[]): any {\n    let wrapper = this.wrap(fn);\n    // @ts-ignore\n    return wrapper.apply(this, Array.prototype.slice.call(arguments, 1));\n  }\n}\n\nclass Routes {\n  _notifier: BaseNotifier;\n  _routes: RoutesStats;\n  _breakdowns: RoutesBreakdowns;\n  _opt: IOptions;\n\n  constructor(notifier: BaseNotifier) {\n    this._notifier = notifier;\n    this._routes = new RoutesStats(notifier._opt);\n    this._breakdowns = new RoutesBreakdowns(notifier._opt);\n    this._opt = notifier._opt;\n  }\n\n  start(\n    method = '',\n    route = '',\n    statusCode = 0,\n    contentType = ''\n  ): RouteMetric {\n    const metric = new RouteMetric(method, route, statusCode, contentType);\n\n    if (!this._opt.performanceStats) {\n      return metric;\n    }\n\n    const scope = this._notifier.scope().clone();\n    scope.setContext({ httpMethod: method, route });\n    scope.setRouteMetric(metric);\n    this._notifier.setActiveScope(scope);\n\n    return metric;\n  }\n\n  notify(req: RouteMetric): void {\n    if (!this._opt.performanceStats) {\n      return;\n    }\n\n    req.end();\n\n    for (const performanceFilter of this._notifier._performanceFilters) {\n      if (performanceFilter(req) === null) {\n        return;\n      }\n    }\n    this._routes.notify(req);\n    this._breakdowns.notify(req);\n  }\n}\n\nclass Queues {\n  _notifier: BaseNotifier;\n  _queues: QueuesStats;\n  _opt: IOptions;\n\n  constructor(notifier: BaseNotifier) {\n    this._notifier = notifier;\n    this._queues = new QueuesStats(notifier._opt);\n    this._opt = notifier._opt;\n  }\n\n  start(queue: string): QueueMetric {\n    const metric = new QueueMetric(queue);\n\n    if (!this._opt.performanceStats) {\n      return metric;\n    }\n\n    const scope = this._notifier.scope().clone();\n    scope.setContext({ queue });\n    scope.setQueueMetric(metric);\n    this._notifier.setActiveScope(scope);\n\n    return metric;\n  }\n\n  notify(q: QueueMetric): void {\n    if (!this._opt.performanceStats) {\n      return;\n    }\n\n    q.end();\n    this._queues.notify(q);\n  }\n}\n","import { INotice } from '../notice';\n\nexport function windowFilter(notice: INotice): INotice {\n  if (window.navigator && window.navigator.userAgent) {\n    notice.context.userAgent = window.navigator.userAgent;\n  }\n  if (window.location) {\n    notice.context.url = String(window.location);\n    // Set root directory to group errors on different subdomains together.\n    notice.context.rootDirectory =\n      window.location.protocol + '//' + window.location.host;\n  }\n  return notice;\n}\n","import { IFuncWrapper } from '../func_wrapper';\nimport { Notifier } from '../notifier';\n\nconst CONSOLE_METHODS = ['debug', 'log', 'info', 'warn', 'error'];\n\nexport function instrumentConsole(notifier: Notifier): void {\n  // tslint:disable-next-line:no-this-assignment\n  for (let m of CONSOLE_METHODS) {\n    if (!(m in console)) {\n      continue;\n    }\n\n    const oldFn = console[m];\n    let newFn = ((...args) => {\n      oldFn.apply(console, args);\n      notifier.scope().pushHistory({\n        type: 'log',\n        severity: m,\n        arguments: args,\n      });\n    }) as IFuncWrapper;\n    newFn.inner = oldFn;\n    console[m] = newFn;\n  }\n}\n","import { Notifier } from '../notifier';\n\nconst elemAttrs = ['type', 'name', 'src'];\n\nexport function instrumentDOM(notifier: Notifier) {\n  const handler = makeEventHandler(notifier);\n\n  if (window.addEventListener) {\n    window.addEventListener('load', handler);\n    window.addEventListener(\n      'error',\n      (event: Event): void => {\n        if (getProp(event, 'error')) {\n          return;\n        }\n        handler(event);\n      },\n      true\n    );\n  }\n\n  if (typeof document === 'object' && document.addEventListener) {\n    document.addEventListener('DOMContentLoaded', handler);\n    document.addEventListener('click', handler);\n    document.addEventListener('keypress', handler);\n  }\n}\n\nfunction makeEventHandler(notifier: Notifier): EventListener {\n  return (event: Event): void => {\n    let target = getProp(event, 'target') as HTMLElement | null;\n    if (!target) {\n      return;\n    }\n\n    let state: any = { type: event.type };\n\n    try {\n      state.target = elemPath(target);\n    } catch (err) {\n      state.target = `<${String(err)}>`;\n    }\n\n    notifier.scope().pushHistory(state);\n  };\n}\n\nfunction elemName(elem: HTMLElement): string {\n  if (!elem) {\n    return '';\n  }\n\n  let s: string[] = [];\n\n  if (elem.tagName) {\n    s.push(elem.tagName.toLowerCase());\n  }\n\n  if (elem.id) {\n    s.push('#');\n    s.push(elem.id);\n  }\n\n  if (elem.classList && Array.from) {\n    s.push('.');\n    s.push(Array.from(elem.classList).join('.'));\n  } else if (elem.className) {\n    let str = classNameString(elem.className);\n    if (str !== '') {\n      s.push('.');\n      s.push(str);\n    }\n  }\n\n  if (elem.getAttribute) {\n    for (let attr of elemAttrs) {\n      let value = elem.getAttribute(attr);\n      if (value) {\n        s.push(`[${attr}=\"${value}\"]`);\n      }\n    }\n  }\n\n  return s.join('');\n}\n\nfunction classNameString(name: any): string {\n  if (name.split) {\n    return name.split(' ').join('.');\n  }\n  if (name.baseVal && name.baseVal.split) {\n    // SVGAnimatedString\n    return name.baseVal.split(' ').join('.');\n  }\n  console.error('unsupported HTMLElement.className type', typeof name);\n  return '';\n}\n\nfunction elemPath(elem: HTMLElement): string {\n  const maxLen = 10;\n\n  let path: string[] = [];\n\n  let parent = elem;\n  while (parent) {\n    let name = elemName(parent);\n    if (name !== '') {\n      path.push(name);\n      if (path.length > maxLen) {\n        break;\n      }\n    }\n    parent = parent.parentNode as HTMLElement;\n  }\n\n  if (path.length === 0) {\n    return String(elem);\n  }\n\n  return path.reverse().join(' > ');\n}\n\nfunction getProp(obj: any, prop: string): any {\n  try {\n    return obj[prop];\n  } catch (_) {\n    // Permission denied to access property\n    return null;\n  }\n}\n","import { Notifier } from '../notifier';\n\nexport function instrumentFetch(notifier: Notifier): void {\n  // tslint:disable-next-line:no-this-assignment\n  let oldFetch = window.fetch;\n  // @ts-ignore\n  window.fetch = function (\n    req: RequestInfo,\n    options?: RequestInit\n  ): Promise<Response> {\n    let state: any = {\n      type: 'xhr',\n      date: new Date(),\n    };\n\n    state.method = options && options.method ? options.method : 'GET';\n    if (typeof req === 'string') {\n      state.url = req;\n    } else {\n      state.method = req.method;\n      state.url = req.url;\n    }\n\n    // Some platforms (e.g. react-native) implement fetch via XHR.\n    notifier._ignoreNextXHR++;\n    setTimeout(() => notifier._ignoreNextXHR--);\n\n    return oldFetch\n      // @ts-ignore\n      .apply(this, arguments)\n      .then((resp: Response) => {\n        state.statusCode = resp.status;\n        state.duration = new Date().getTime() - state.date.getTime();\n        notifier.scope().pushHistory(state);\n        return resp;\n      })\n      .catch((err) => {\n        state.error = err;\n        state.duration = new Date().getTime() - state.date.getTime();\n        notifier.scope().pushHistory(state);\n        throw err;\n      });\n  };\n}\n","import { Notifier } from '../notifier';\n\nlet lastLocation = '';\n\n// In some environments (i.e. Cypress) document.location may sometimes be null\nfunction getCurrentLocation(): string | null {\n  return document.location && document.location.pathname;\n}\n\nexport function instrumentLocation(notifier: Notifier): void {\n  // @ts-ignore\n  lastLocation = getCurrentLocation();\n\n  const oldFn = window.onpopstate;\n  window.onpopstate = function abOnpopstate(_event: PopStateEvent): any {\n    const url = getCurrentLocation();\n    if (url) {\n      recordLocation(notifier, url);\n    }\n    if (oldFn) {\n      // @ts-ignore\n      return oldFn.apply(this, arguments);\n    }\n  };\n\n  const oldPushState = history.pushState;\n  history.pushState = function abPushState(\n    _state: any,\n    _title: string,\n    url?: string | null\n  ): void {\n    if (url) {\n      recordLocation(notifier, url.toString());\n    }\n    // @ts-ignore\n    oldPushState.apply(this, arguments);\n  };\n}\n\nfunction recordLocation(notifier: Notifier, url: string): void {\n  let index = url.indexOf('://');\n  if (index >= 0) {\n    url = url.slice(index + 3);\n    index = url.indexOf('/');\n    url = index >= 0 ? url.slice(index) : '/';\n  } else if (url.charAt(0) !== '/') {\n    url = '/' + url;\n  }\n\n  notifier.scope().pushHistory({\n    type: 'location',\n    from: lastLocation,\n    to: url,\n  });\n  lastLocation = url;\n}\n","import { Notifier } from '../notifier';\n\ninterface IXMLHttpRequestWithState extends XMLHttpRequest {\n  __state: any;\n}\n\nexport function instrumentXHR(notifier: Notifier): void {\n  function recordReq(req: IXMLHttpRequestWithState): void {\n    const state = req.__state;\n    state.statusCode = req.status;\n    state.duration = new Date().getTime() - state.date.getTime();\n    notifier.scope().pushHistory(state);\n  }\n\n  const oldOpen = XMLHttpRequest.prototype.open;\n  XMLHttpRequest.prototype.open = function abOpen(\n    method: string,\n    url: string,\n    _async?: boolean,\n    _user?: string,\n    _password?: string\n  ): void {\n    if (notifier._ignoreNextXHR === 0) {\n      // @ts-ignore\n      this.__state = {\n        type: 'xhr',\n        method,\n        url,\n      };\n    }\n    // @ts-ignore\n    oldOpen.apply(this, arguments);\n  };\n\n  const oldSend = XMLHttpRequest.prototype.send;\n  XMLHttpRequest.prototype.send = function abSend(_data?: any): void {\n    let oldFn = this.onreadystatechange;\n    this.onreadystatechange = function (_ev: Event): any {\n      // @ts-ignore\n      if (this.readyState === 4 && this.__state) {\n        // @ts-ignore\n        recordReq(this);\n      }\n      if (oldFn) {\n        // @ts-ignore\n        return oldFn.apply(this, arguments);\n      }\n    };\n\n    // @ts-ignore\n    if (this.__state) {\n      (this as IXMLHttpRequestWithState).__state.date = new Date();\n    }\n    // @ts-ignore\n    return oldSend.apply(this, arguments);\n  };\n}\n","import { Notifier } from '../notifier';\n\nexport function instrumentUnhandledrejection(notifier: Notifier): void {\n  const handler = onUnhandledrejection.bind(notifier);\n\n  window.addEventListener('unhandledrejection', handler);\n  notifier._onClose.push(() => {\n    window.removeEventListener('unhandledrejection', handler);\n  });\n}\n\nfunction onUnhandledrejection(e: any): void {\n  // Handle native or bluebird Promise rejections\n  // https://developer.mozilla.org/en-US/docs/Web/Events/unhandledrejection\n  // http://bluebirdjs.com/docs/api/error-management-configuration.html\n  let reason = e.reason || (e.detail && e.detail.reason);\n  if (!reason) return;\n\n  let msg = reason.message || String(reason);\n  if (msg.indexOf && msg.indexOf('airbrake: ') === 0) return;\n\n  if (typeof reason !== 'object' || reason.error === undefined) {\n    // @ts-ignore\n    this.notify({\n      error: reason,\n      context: {\n        unhandledRejection: true,\n      },\n    });\n    return;\n  }\n\n  // @ts-ignore\n  this.notify({ ...reason, context: { unhandledRejection: true } });\n}\n","import { BaseNotifier } from './base_notifier';\nimport { windowFilter } from './filter/window';\nimport { instrumentConsole } from './instrumentation/console';\nimport { instrumentDOM } from './instrumentation/dom';\nimport { instrumentFetch } from './instrumentation/fetch';\nimport { instrumentLocation } from './instrumentation/location';\nimport { instrumentXHR } from './instrumentation/xhr';\nimport { instrumentUnhandledrejection } from './instrumentation/unhandledrejection';\nimport { INotice } from './notice';\nimport { IInstrumentationOptions, IOptions } from './options';\n\ninterface ITodo {\n  err: any;\n  resolve: (notice: INotice) => void;\n  reject: (err: Error) => void;\n}\n\nexport class Notifier extends BaseNotifier {\n  protected offline = false;\n  protected todo: ITodo[] = [];\n\n  _ignoreWindowError = 0;\n  _ignoreNextXHR = 0;\n\n  constructor(opt: IOptions) {\n    super(opt);\n\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    this.addFilter(windowFilter);\n\n    if (window.addEventListener) {\n      this.onOnline = this.onOnline.bind(this);\n      window.addEventListener('online', this.onOnline);\n      this.onOffline = this.onOffline.bind(this);\n      window.addEventListener('offline', this.onOffline);\n\n      this._onClose.push(() => {\n        window.removeEventListener('online', this.onOnline);\n        window.removeEventListener('offline', this.onOffline);\n      });\n    }\n\n    this._instrument(opt.instrumentation);\n  }\n\n  _instrument(opt: IInstrumentationOptions = {}) {\n    if (opt.console === undefined) {\n      opt.console = !isDevEnv(this._opt.environment);\n    }\n\n    if (enabled(opt.onerror)) {\n      // tslint:disable-next-line:no-this-assignment\n      let self = this;\n      let oldHandler = window.onerror;\n      window.onerror = function abOnerror() {\n        if (oldHandler) {\n          // @ts-ignore\n          oldHandler.apply(this, arguments);\n        }\n        // @ts-ignore\n        self.onerror.apply(self, arguments);\n      };\n    }\n\n    instrumentDOM(this);\n    if (enabled(opt.fetch) && typeof fetch === 'function') {\n      instrumentFetch(this);\n    }\n    if (enabled(opt.history) && typeof history === 'object') {\n      instrumentLocation(this);\n    }\n    if (enabled(opt.console) && typeof console === 'object') {\n      instrumentConsole(this);\n    }\n    if (enabled(opt.xhr) && typeof XMLHttpRequest !== 'undefined') {\n      instrumentXHR(this);\n    }\n    if (\n      enabled(opt.unhandledrejection) &&\n      typeof addEventListener === 'function'\n    ) {\n      instrumentUnhandledrejection(this);\n    }\n  }\n\n  public notify(err: any): Promise<INotice> {\n    if (this.offline) {\n      return new Promise((resolve, reject) => {\n        this.todo.push({\n          err,\n          resolve,\n          reject,\n        });\n        while (this.todo.length > 100) {\n          let j = this.todo.shift();\n          if (j === undefined) {\n            break;\n          }\n          j.resolve({\n            error: new Error('airbrake: offline queue is too large'),\n          });\n        }\n      });\n    }\n\n    return super.notify(err);\n  }\n\n  protected onOnline(): void {\n    this.offline = false;\n\n    for (let j of this.todo) {\n      this.notify(j.err).then((notice) => {\n        j.resolve(notice);\n      });\n    }\n    this.todo = [];\n  }\n\n  protected onOffline(): void {\n    this.offline = true;\n  }\n\n  onerror(\n    message: string,\n    filename?: string,\n    line?: number,\n    column?: number,\n    err?: Error\n  ): void {\n    if (this._ignoreWindowError > 0) {\n      return;\n    }\n\n    if (err) {\n      this.notify({\n        error: err,\n        context: {\n          windowError: true,\n        },\n      });\n      return;\n    }\n\n    // Ignore errors without file or line.\n    if (!filename || !line) {\n      return;\n    }\n\n    this.notify({\n      error: {\n        message,\n        fileName: filename,\n        lineNumber: line,\n        columnNumber: column,\n        noStack: true,\n      },\n      context: {\n        windowError: true,\n      },\n    });\n  }\n\n  _ignoreNextWindowError(): void {\n    this._ignoreWindowError++;\n    setTimeout(() => this._ignoreWindowError--);\n  }\n}\n\nfunction isDevEnv(env: any): boolean {\n  return env && env.startsWith && env.startsWith('dev');\n}\n\nfunction enabled(v: undefined | boolean): boolean {\n  return v === undefined || v === true;\n}\n"],"names":["FILTERED","MAX_OBJ_LENGTH","jsonifyNotice","notice","maxLength","keysBlocklist","keysAllowlist","i","t","Truncator","keys","level","opts","key","obj","truncate","params","err","scale","num","value","depth","type","objectType","saved","index","path","sub","getAttr","s","arr","length","dst","el","isInList","attr","list","v","Span","metric","name","startTime","endTime","now","BaseMetric","span","ms","NoopMetric","_name","_startTime","_ms","Scope","clone","context","ctx","state","root","factory","module","this","_isNumber","n","_capitalize","str","_getter","p","booleanProps","numericProps","stringProps","arrayProps","objectProps","props","StackFrame","fileName","lineNumber","columnNumber","functionName","argsStartIndex","argsEndIndex","args","locationString","parts","j","k","require$$0","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","error","urlLike","regExp","filtered","line","sanitizedLine","location","locationParts","functionNameRegex","matches","e","lineRE","lines","result","len","match","tokens","functionCall","argsRaw","hasConsole","parse","ErrorStackParser","parseErr","espProcessor","backtrace","frames","fakeErr","frame","msg","re","angularMessageFilter","m","makeDebounceFilter","lastNoticeJSON","timeout","IGNORED_MESSAGES","ignoreNoiseFilter","uncaughtMessageFilter","errors","rateLimitReset","request","req","opt","resp","json","body","makeRequester","api","resolve","reject","h","makeNodeRequester","fetchRequest","tdigest","hasTdigest","TDigestStat","tdigestCentroids","TDigestStatGroups","totalMs","groups","stat","td","means","counts","c","FLUSH_INTERVAL","QueryInfo","query","QueriesStats","q","minute","keyStr","queries","outJSON","_resp","QueueMetric","queue","QueuesStats","queues","RouteMetric","method","route","statusCode","contentType","RoutesStats","routes","RoutesBreakdowns","NOTIFIER_NAME","NOTIFIER_VERSION","NOTIFIER_URL","API_VER","DEFAULT_INTERVAL","NOTIFIER_INFO","ERROR_SETTING","APM_SETTING","RemoteSettings","SettingsData","pollerId","_","url","queryParams","data","ownProps","resArray","projectId","other","remoteConfigHost","host","configRoute","settings","setting","BaseNotifier","Routes","Queues","fn","scope","filter","performanceFilter","r","client","airbrakeWrapper","fnArgs","wrappedArgs","prop","arg","_args","notifier","windowFilter","CONSOLE_METHODS","instrumentConsole","oldFn","newFn","elemAttrs","instrumentDOM","handler","makeEventHandler","event","getProp","target","elemPath","elemName","elem","classNameString","parent","instrumentFetch","oldFetch","options","lastLocation","getCurrentLocation","instrumentLocation","_event","recordLocation","oldPushState","_state","_title","instrumentXHR","recordReq","oldOpen","_async","_user","_password","oldSend","_data","_ev","instrumentUnhandledrejection","onUnhandledrejection","reason","Notifier","isDevEnv","enabled","self","oldHandler","message","filename","column","env"],"mappings":"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","x_google_ignoreList":[3,4]}